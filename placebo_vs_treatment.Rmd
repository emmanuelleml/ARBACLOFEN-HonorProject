---
title: "R Notebook"
output: html_notebook
---

# Look for effect of different covariates on 2 groups separately


```{r}
library('dplyr')
library('lme4')
library('sjmisc')
library("ggplot2")
library('afex')
library('jmv')
library('emmeans')
library('effectsize')
library('rstatix')
library('haven')
library("readxl")
library('expss')
library('epiDisplay')
library("writexl")
```


```{r}
data <- read_excel("C:/Users/Admin/Desktop/ARBA/behavioral database.xlsx")
```

```{r}

tab_all <- data.frame(sub = data$sub, gender = factor(data$GENDER_STD), age = data$AGE, verbal_IQ = data$VERBAL_IQ, nonverbal_IQ = data$NON_VERBAL_IQ, IQ = data$FULL_SCALE_IQ, nbr_AE = data$nbr_AE, SR = data$`Sleep Related`,
                        condition = data$cond,
                        VABS3_COM_W0 = data$VABS3_COM_SS.0, delta_VABS3_COM = data$delta_VABS3_COM,
                        VABS3_SOC_W0 = data$VABS3_SOC_SS.0, delta_VABS3_SOC = data$delta_VABS3_SOC,
                        VABS3_IPR_GSV_W0 = data$VABS3_IPR_GSV.0, delta_VABS3_IPR_GSV = data$delta_VABS3_IPR_GSV,
                        VABS3_PLA_GSV_W0 = data$VABS3_PLA_GSV.0, delta_VABS3_PLA_GSV = data$delta_VABS3_PLA_GSV,  
                        VABS3_COP_GSV_W0 = data$VABS3_COP_GSV.0, delta_VABS3_COP_GSV = data$delta_VABS3_COP_GSV, 
                        AIM_total_W0 = data$AIM_total.0, delta_AIM_total = data$delta_AIM_total,
                        AIM_sums_W0 = data$AIM_sums.0, delta_AIM_sums = data$delta_AIM_sums,
                        AIM_atypical_W0 = data$AIM_atypical.0, delta_AIM_atypical = data$delta_AIM_atypical,
                        AIM_recip_W0 = data$AIM_reciprocity.0, delta_AIM_recip = data$delta_AIM_reciprocity,
                        AIM_com_W0 = data$AIM_communication.0, delta_AIM_com = data$delta_AIM_communication,
                        AIM_rep_beh_W0 = data$AIM_repetitive_behavior.0, delta_AIM_rep_beh = data$delta_AIM_repetitive_behavior,
                        AIM_rep_lang_W0 = data$AIM_repetitive_language.0, delta_AIM_rep_lang = data$delta_AIM_repetitive_language,
                        AIM_frequency_W0 = data$AIM_frequency.0, delta_AIM_freq = data$delta_AIM_frequency,
                        AIM_impact_W0 = data$AIM_impact.0, delta_AIM_impact = data$delta_AIM_impact,
                        ABC_hyper_W0 = data$ABC_hyperactivity.0, delta_ABC_hyper = data$delta_ABC_hyperactivity,
                        ABC_irrit_W0 = data$ABC_irritability.0, delta_ABC_irrit = data$delta_ABC_irritability,
                        ABC_ste_beh_W0 = data$ABC_stereotypic_behavior.0, delta_ABC_ste_beh = data$delta_ABC_stereotypic_behavior,
                        ABC_inap_speech_W0 = data$ABC_inappropriate_speech.0, delta_ABC_inap_speech = data$delta_ABC_inappropriate_speech,
                        ABC_soc_wit_W0 = data$ABC_social_withdrawal.0, delta_ABC_soc_wit = data$delta_ABC_social_withdrawal,
                        ABC_lethargy_W0 = data$ABC_lethargy.0, delta_ABC_lethargy = data$delta_ABC_lethargy, 
                        SEQ_total_W0 = data$SEQ_total.0, delta_SEQ_total = data$delta_SEQ_total,
                        SEQ_HYPER_W0 = data$SEQ_response_pattern_HYPER.0, delta_SEQ_HYPER = data$delta_SEQ_response_pattern_HYPER,
                        SEQ_HYPO_W0 = data$SEQ_response_pattern_HYPO.0, delta_SEQ_HYPO = data$delta_SEQ_response_pattern_HYPO,
                        SEQ_SIRS_W0 = data$SEQ_response_pattern_SIRS.0, delta_SEQ_SIRS = data$delta_SEQ_response_pattern_SIRS,
                        SEQ_EP_W0 = data$SEQ_response_pattern_EP.0,  delta_SEQ_EP = data$delta_SEQ_response_pattern_EP,
                        SEQ_nonsocial_W0 = data$SEQ_context_nonsocial.0, delta_SEQ_nonsocial = data$delta_SEQ_context_nonsocial,
                        SEQ_social_W0 = data$SEQ_context_social.0, delta_SEQ_social = data$delta_SEQ_context_social,
                        SEQ_auditory_W0 = data$SEQ_sensory_modality_auditory.0, delta_SEQ_auditory = data$delta_SEQ_sensory_modality_auditory,
                        SEQ_visual_W0 = data$SEQ_sensory_modality_visual.0, delta_SEQ_visual = data$delta_SEQ_sensory_modality_visual,
                        SEQ_tactile_W0 = data$SEQ_sensory_modality_tactile.0, delta_SEQ_tactile = data$delta_SEQ_sensory_modality_tactile,  
                        SEQ_gusta_olfac_W0 = data$SEQ_sensory_modality_gustatory_olfactory.0, delta_SEQ_gusta_olfac = data$delta_SEQ_sensory_modality_gustatory_olfactory, 
                        SEQ_ves_pro_W0 = data$SEQ_sensory_modality_vestibular_proprioception.0, delta_SEQ_ves_pro = data$delta_SEQ_sensory_modality_vestibular_proprioception,
                        VABS3_COM_W112 = data$VABS3_COM_SS.112, VABS3_SOC_W112 = data$VABS3_SOC_SS.112, VABS3_IPR_GSV_W112 = data$VABS3_IPR_GSV.112, 
                        VABS3_PLA_GSV_W112 = data$VABS3_PLA_GSV.112, VABS3_COP_GSV_W112 = data$VABS3_COP_GSV.112,
                        AIM_total_W112 = data$AIM_total.112,
                        AIM_sums_W112 = data$AIM_sums.112, AIM_atypical_W112 = data$AIM_atypical.112, AIM_recip_W112 = data$AIM_reciprocity.112,
                        AIM_com_W112 = data$AIM_communication.112,  AIM_rep_beh_W112 = data$AIM_repetitive_behavior.112, AIM_rep_lang_W112 = data$AIM_repetitive_language.112, 
                        AIM_frequency_W112 = data$AIM_frequency.112, AIM_impact_W112 = data$AIM_impact.112, ABC_hyper_W112 = data$ABC_hyperactivity.112, 
                        ABC_irrit_W112 = data$ABC_irritability.112,  ABC_ste_beh_W112 = data$ABC_stereotypic_behavior.112, ABC_inap_speech_W112 = data$ABC_inappropriate_speech.112, 
                        ABC_soc_wit_W112 = data$ABC_social_withdrawal.112, ABC_lethargy_W112 = data$ABC_lethargy.112,  
                        SEQ_total_W112 = data$SEQ_total.112, SEQ_HYPER_W112 = data$SEQ_response_pattern_HYPER.112, SEQ_HYPO_W112 = data$SEQ_response_pattern_HYPO.112, 
                        SEQ_SIRS_W112 = data$SEQ_response_pattern_SIRS.112, SEQ_EP_W112 = data$SEQ_response_pattern_EP.112, SEQ_nonsocial_W112 = data$SEQ_context_nonsocial.112, 
                        SEQ_social_W112 = data$SEQ_context_social.112, SEQ_auditory_W112 = data$SEQ_sensory_modality_auditory.112, SEQ_visual_W112 = data$SEQ_sensory_modality_visual.112, 
                        SEQ_tactile_W112 = data$SEQ_sensory_modality_tactile.112, SEQ_gusta_olfac_W112 = data$SEQ_sensory_modality_gustatory_olfactory.112, 
                        SEQ_ves_pro_W112 = data$SEQ_sensory_modality_vestibular_proprioception.112)
```

```{r}
tab_all['condition'][tab_all['condition'] == "0"] <- "placebo"
tab_all['condition'][tab_all['condition'] == "1"] <- "ARBA"
```

#389, 461 et 963 --> Pas inclus dans les analyses de Rae
# 446 --> n'a aucun score post donc je l'ai retiré direct. donc mon échantillon a une personne de moins que Rae
```{r}
tab_EEG <- subset(tab_all, (sub != 1050389 & sub != 1050461 & sub != 1050963))
tab <- subset(tab_all, (sub != 1050389 & sub != 1050461 & sub != 1050963 & sub != 1140446))
```

```{r}
frq(tab_EEG$condition)
frq(subset(tab_EEG, condition == "ARBA")$gender)
frq(subset(tab_EEG, condition == "placebo")$gender)

jmv::descriptives(tab_EEG, vars(age, nonverbal_IQ), skew = T, kurt = T, median = F, splitBy = condition)
```



# Check normality of distributions of post-pré scores (delta)
= OK
```{r}
jmv::descriptives(tab, vars(delta_AIM_atypical, delta_AIM_recip, delta_AIM_com, delta_AIM_rep_beh), skew = T, kurt = T, median = F)
```



# Forming the groups with the RCI method
```{r}
frq(tab$age)
subset(tab, age<=6) # 6 ans : 1
subset(tab, age>6 & age <=12) # 7-12 ans : 26
subset(tab, age>=13) # 13 et + : 36

# communication : 0.85, 0.89, 0.92
coef_com = (1*0.85 + 26*0.89 + 36*0.92)/63 #--> r = 0.9065
# Social : 0.76, 0.80, 0.81
coef_soc = (1*0.76 + 26*0.80 + 36*0.81)/63 #--> r = 0.8051
# IPR GSV : 0.71, 0.76, 0.68
coef_IPR_GSV = (1*0.71 + 26*0.76 + 36*0.68)/63 #--> r = 0.7135
# PLA GSV : 0.64, 0.83, 0.88
coef_PLA_GSV = (1*0.64 + 26*0.83 + 36*0.88)/63 #--> r = 0.8556
# COP GSV : 0.73, 0.73, 0.69
coef_COP_GSV = (1*0.73 + 26*0.73 + 36*0.69)/63 #--> r = 0.7071
```
## Vineland 3
```{r}
# COM
SEM_COM_0 = sd(tab$VABS3_COM_W0)*sqrt(1-coef_com)
SEM_COM_112 = sd(tab$VABS3_COM_W112, na.rm = TRUE)*sqrt(1-coef_com)
SE_COM = sqrt((SEM_COM_0^2)+(SEM_COM_112^2))
CI_COM = SE_COM* 1.64 # 10.72
tab$response_VABS3_COM <- ifelse(tab$delta_VABS3_COM >= CI_COM, "improvement", "stable")
tab$response_VABS3_COM <- ifelse(tab$delta_VABS3_COM <= -CI_COM, "decline", tab$response_VABS3_COM)
sjmisc::frq(tab$response_VABS3_COM)

# SOC
SEM_SOC_0 = sd(tab$VABS3_SOC_W0)*sqrt(1-coef_soc)
SEM_SOC_112 = sd(tab$VABS3_SOC_W112, na.rm = TRUE)*sqrt(1-coef_soc)
SE_SOC = sqrt((SEM_SOC_0^2)+(SEM_SOC_112^2))
CI_SOC = SE_SOC* 1.64
tab$response_VABS3_SOC <- ifelse(tab$delta_VABS3_SOC >= CI_SOC, "improvement", "stable")
tab$response_VABS3_SOC <- ifelse(tab$delta_VABS3_SOC <= -CI_SOC, "decline", tab$response_VABS3_SOC)
sjmisc::frq(tab$response_VABS3_SOC)

# IPR GSV
SEM_IPR_GSV_0 = sd(tab$VABS3_IPR_GSV_W0)*sqrt(1-coef_IPR_GSV)
SEM_IPR_GSV_112 = sd(tab$VABS3_IPR_GSV_W112, na.rm = TRUE)*sqrt(1-coef_IPR_GSV)
SE_IPR_GSV = sqrt((SEM_IPR_GSV_0^2)+(SEM_IPR_GSV_112^2))
CI_IPR_GSV = SE_IPR_GSV* 1.64
tab$response_VABS3_IPR_GSV <- ifelse(tab$delta_VABS3_IPR_GSV >= CI_IPR_GSV, "improvement", "stable")
tab$response_VABS3_IPR_GSV <- ifelse(tab$delta_VABS3_IPR_GSV <= -CI_IPR_GSV, "decline", tab$response_VABS3_IPR_GSV)
sjmisc::frq(tab$response_VABS3_IPR_GSV)

# PLA GSV
SEM_PLA_GSV_0 = sd(tab$VABS3_PLA_GSV_W0)*sqrt(1-coef_PLA_GSV)
SEM_PLA_GSV_112 = sd(tab$VABS3_PLA_GSV_W112, na.rm = TRUE)*sqrt(1-coef_PLA_GSV)
SE_PLA_GSV = sqrt((SEM_PLA_GSV_0^2)+(SEM_PLA_GSV_112^2))
CI_PLA_GSV = SE_PLA_GSV* 1.64
tab$response_VABS3_PLA_GSV <- ifelse(tab$delta_VABS3_PLA_GSV >= CI_PLA_GSV, "improvement", "stable")
tab$response_VABS3_PLA_GSV <- ifelse(tab$delta_VABS3_PLA_GSV <= -CI_PLA_GSV, "decline", tab$response_VABS3_PLA_GSV)
sjmisc::frq(tab$response_VABS3_PLA_GSV)

# COP GSV
SEM_COP_GSV_0 = sd(tab$VABS3_COP_GSV_W0)*sqrt(1-coef_COP_GSV)
SEM_COP_GSV_112 = sd(tab$VABS3_COP_GSV_W112, na.rm = TRUE)*sqrt(1-coef_COP_GSV)
SE_COP_GSV = sqrt((SEM_COP_GSV_0^2)+(SEM_COP_GSV_112^2))
CI_COP_GSV = SE_COP_GSV* 1.64 
tab$response_VABS3_COP_GSV <- ifelse(tab$delta_VABS3_COP_GSV >= CI_COP_GSV, "improvement", "stable")
tab$response_VABS3_COP_GSV <- ifelse(tab$delta_VABS3_COP_GSV <= -CI_COP_GSV, "decline", tab$response_VABS3_COP_GSV)
sjmisc::frq(tab$response_VABS3_COP_GSV)


# Tableaux de fréquences
tab %>% group_by(condition, response_VABS3_COM) %>% summarize(Freq=n())
tab %>% group_by(condition, response_VABS3_SOC) %>% summarize(Freq=n())
tab %>% group_by(condition, response_VABS3_IPR_GSV) %>% summarize(Freq=n())
tab %>% group_by(condition, response_VABS3_PLA_GSV) %>% summarize(Freq=n())
tab %>% group_by(condition, response_VABS3_COP_GSV) %>% summarize(Freq=n())

```


## AIM
Peux pas trouver/déduire/calculer les coeff test-retest de freq et impact pour le moment donc peux pas les faire --> moyenne des 2 coeff
Repetitive language est pas là non plus

```{r}
# SEM 1
SEM_atypical_0 = sd(tab$AIM_atypical_W0)*sqrt(1-0.655)
SEM_recip_0 = sd(tab$AIM_recip_W0)*sqrt(1-0.66)
SEM_com_0 = sd(tab$AIM_com_W0)*sqrt(1-0.815)
SEM_rep_beh_0 = sd(tab$AIM_rep_beh_W0)*sqrt(1-0.80)
SEM_rep_lang_0 = sd(tab$AIM_rep_lang_W0)*sqrt(1-0.655)

# SEM 2
SEM_atypical_112 = sd(tab$AIM_atypical_W112, na.rm = TRUE)*sqrt(1-0.655)
SEM_recip_112 = sd(tab$AIM_recip_W112, na.rm = TRUE)*sqrt(1-0.66)
SEM_com_112 = sd(tab$AIM_com_W112, na.rm = TRUE)*sqrt(1-0.815)
SEM_rep_beh_112 = sd(tab$AIM_rep_beh_W112, na.rm = TRUE)*sqrt(1-0.80)
SEM_rep_lang_112 = sd(tab$AIM_rep_lang_W112, na.rm = TRUE)*sqrt(1-0.655)

# SE diff
SE_atypical = sqrt((SEM_atypical_0^2)+(SEM_atypical_112^2))
SE_recip = sqrt((SEM_recip_0^2)+(SEM_recip_112^2))
SE_com = sqrt((SEM_com_0^2)+(SEM_com_112^2))
SE_rep_beh = sqrt((SEM_rep_beh_0^2)+(SEM_rep_beh_112^2))
SE_rep_lang = sqrt((SEM_rep_lang_0^2)+(SEM_rep_lang_112^2))

# AIM atypical
CI_atypical = SE_atypical* 1.64 # 11.51
tab$response_AIM_atypical <- ifelse(tab$delta_AIM_atypical >= CI_atypical, "improvement", "stable")
tab$response_AIM_atypical <- ifelse(tab$delta_AIM_atypical <= -CI_atypical, "decline", tab$response_AIM_atypical)
sjmisc::frq(tab$response_AIM_atypical)

# AIM recip
CI_recip = SE_recip* 1.64 # 13.07
tab$response_AIM_recip <- ifelse(tab$delta_AIM_recip >= CI_recip, "improvement", "stable")
tab$response_AIM_recip <- ifelse(tab$delta_AIM_recip <= -CI_recip, "decline", tab$response_AIM_recip)
sjmisc::frq(tab$response_AIM_recip)

#AIM com 
CI_com = SE_com* 1.64 # 6.07
tab$response_AIM_com <- ifelse(tab$delta_AIM_com >= CI_com, "improvement", 0)
tab$response_AIM_com <- ifelse(abs(tab$delta_AIM_com) < CI_com, "stable", tab$response_AIM_com)
tab$response_AIM_com <- ifelse(tab$delta_AIM_com <= -CI_com, "decline", tab$response_AIM_com)
sjmisc::frq(tab$response_AIM_com)

# AIM repetitive behavior
CI_rep_beh = SE_rep_beh* 1.64 # 15.23
tab$response_AIM_rep_beh <- ifelse(tab$delta_AIM_rep_beh >= CI_rep_beh, "improvement", 0)
tab$response_AIM_rep_beh <- ifelse(abs(tab$delta_AIM_rep_beh) < CI_rep_beh, "stable", tab$response_AIM_rep_beh)
tab$response_AIM_rep_beh <- ifelse(tab$delta_AIM_rep_beh <= -CI_rep_beh, "decline", tab$response_AIM_rep_beh)
sjmisc::frq(tab$response_AIM_rep_beh)

# AIM repetitive language
CI_rep_lang = SE_rep_lang* 1.64
tab$response_AIM_rep_lang <- ifelse(tab$delta_AIM_rep_lang >= CI_rep_lang, "improvement", 0)
tab$response_AIM_rep_lang <- ifelse(abs(tab$delta_AIM_rep_lang) < CI_rep_lang, "stable", tab$response_AIM_rep_lang)
tab$response_AIM_rep_lang <- ifelse(tab$delta_AIM_rep_lang <= -CI_rep_lang, "decline", tab$response_AIM_rep_lang)
sjmisc::frq(tab$response_AIM_rep_lang)
```

# ABC-C
0.80-0.90, et 0.60 pour inappropriate speech. mais change rien dans les résultats que je mette 0.80 ou 0.90
https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3290710/#R9
```{r}
# SEM 1
SEM_hyper_0 = sd(tab$ABC_hyper_W0, na.rm = TRUE)*sqrt(1-0.85)
SEM_irrit_0 = sd(tab$ABC_irrit_W0, na.rm = TRUE)*sqrt(1-0.85)
SEM_ste_beh_0 = sd(tab$ABC_ste_beh_W0, na.rm = TRUE)*sqrt(1-0.85)
SEM_inap_speech_0 = sd(tab$ABC_inap_speech_W0, na.rm = TRUE)*sqrt(1-0.60)
SEM_soc_wit_0 = sd(tab$ABC_soc_wit_W0, na.rm = TRUE)*sqrt(1-0.85)
SEM_lethargy_0 = sd(tab$ABC_lethargy_W0, na.rm = TRUE)*sqrt(1-0.85)

# SEM 2
SEM_hyper_112 = sd(tab$ABC_hyper_W112, na.rm = TRUE)*sqrt(1-0.85)
SEM_irrit_112 = sd(tab$ABC_irrit_W112, na.rm = TRUE)*sqrt(1-0.85)
SEM_ste_beh_112 = sd(tab$ABC_ste_beh_W112, na.rm = TRUE)*sqrt(1-0.85)
SEM_inap_speech_112 = sd(tab$ABC_inap_speech_W112, na.rm = TRUE)*sqrt(1-0.60)
SEM_soc_wit_112 = sd(tab$ABC_soc_wit_W112, na.rm = TRUE)*sqrt(1-0.85)
SEM_lethargy_112 = sd(tab$ABC_lethargy_W112, na.rm = TRUE)*sqrt(1-0.85)

# SEdiff
SE_hyper = sqrt((SEM_hyper_0^2)+(SEM_hyper_112^2))
SE_irrit = sqrt((SEM_irrit_0^2)+(SEM_irrit_112^2))
SE_ste_beh = sqrt((SEM_ste_beh_0^2)+(SEM_ste_beh_112^2))
SE_inap_speech = sqrt((SEM_inap_speech_0^2)+(SEM_inap_speech_112^2))
SE_soc_wit = sqrt((SEM_soc_wit_0^2)+(SEM_soc_wit_112^2))
SE_lethargy = sqrt((SEM_lethargy_0^2)+(SEM_lethargy_112^2))

# ABC hyper
CI_hyper = SE_hyper* 1.64
tab$response_ABC_hyper <- ifelse(tab$delta_ABC_hyper >= CI_hyper, "improvement", 0)
tab$response_ABC_hyper <- ifelse(abs(tab$delta_ABC_hyper) < CI_hyper, "stable", tab$response_ABC_hyper)
tab$response_ABC_hyper <- ifelse(tab$delta_ABC_hyper <= -CI_hyper, "decline", tab$response_ABC_hyper)
sjmisc::frq(tab$response_ABC_hyper)

# ABC irrit
CI_irrit = SE_irrit* 1.64
tab$response_ABC_irrit <- ifelse(tab$delta_ABC_irrit >= CI_irrit, "improvement", 0)
tab$response_ABC_irrit <- ifelse(abs(tab$delta_ABC_irrit) < CI_irrit, "stable", tab$response_ABC_irrit)
tab$response_ABC_irrit <- ifelse(tab$delta_ABC_irrit <= -CI_irrit, "decline", tab$response_ABC_irrit)
sjmisc::frq(tab$response_ABC_irrit)

# ABC ste_beh
CI_ste_beh = SE_ste_beh* 1.64
tab$response_ABC_ste_beh <- ifelse(tab$delta_ABC_ste_beh >= CI_ste_beh, "improvement", 0)
tab$response_ABC_ste_beh <- ifelse(abs(tab$delta_ABC_ste_beh) < CI_ste_beh, "stable", tab$response_ABC_ste_beh)
tab$response_ABC_ste_beh <- ifelse(tab$delta_ABC_ste_beh <= -CI_ste_beh, "decline", tab$response_ABC_ste_beh)
sjmisc::frq(tab$response_ABC_ste_beh)

# ABC inap_speech
CI_inap_speech = SE_inap_speech* 1.64
tab$response_ABC_inap_speech <- ifelse(tab$delta_ABC_inap_speech >= CI_inap_speech, "improvement", 0)
tab$response_ABC_inap_speech <- ifelse(abs(tab$delta_ABC_inap_speech) < CI_inap_speech, "stable", tab$response_ABC_inap_speech)
tab$response_ABC_inap_speech <- ifelse(tab$delta_ABC_inap_speech <= -CI_inap_speech, "decline", tab$response_ABC_inap_speech)
sjmisc::frq(tab$response_ABC_inap_speech)

# ABC soc_wit
CI_soc_wit = SE_soc_wit* 1.64
tab$response_ABC_soc_wit <- ifelse(tab$delta_ABC_soc_wit >= CI_soc_wit, "improvement", 0)
tab$response_ABC_soc_wit <- ifelse(abs(tab$delta_ABC_soc_wit) < CI_soc_wit, "stable", tab$response_ABC_soc_wit)
tab$response_ABC_soc_wit <- ifelse(tab$delta_ABC_soc_wit <= -CI_soc_wit, "decline", tab$response_ABC_soc_wit)
sjmisc::frq(tab$response_ABC_soc_wit)

# ABC lethargy
CI_lethargy = SE_lethargy* 1.64
tab$response_ABC_lethargy <- ifelse(tab$delta_ABC_lethargy >= CI_lethargy, "improvement", 0)
tab$response_ABC_lethargy <- ifelse(abs(tab$delta_ABC_lethargy) < CI_lethargy, "stable", tab$response_ABC_lethargy)
tab$response_ABC_lethargy <- ifelse(tab$delta_ABC_lethargy <= -CI_lethargy, "decline", tab$response_ABC_lethargy)
sjmisc::frq(tab$response_ABC_lethargy)

14/31*100
6/32*100
```

# SEQ
0.92 (VERSION 1 *****)
https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3163482/
```{r}
# SEM 1
SEM_total_0 = sd(tab$SEQ_total_W0, na.rm = TRUE)*sqrt(1-0.92)
SEM_HYPER_0 = sd(tab$SEQ_HYPER_W0, na.rm = TRUE)*sqrt(1-0.71)
SEM_HYPO_0 = sd(tab$SEQ_HYPO_W0, na.rm = TRUE)*sqrt(1-0.84)
SEM_SIRS_0 = sd(tab$SEQ_SIRS_W0, na.rm = TRUE)*sqrt(1-0.92)
SEM_EP_0 = sd(tab$SEQ_EP_W0, na.rm = TRUE)*sqrt(1-0.92)
SEM_nonsocial_0 = sd(tab$SEQ_nonsocial_W0, na.rm = TRUE)*sqrt(1-0.68)
SEM_social_0 = sd(tab$SEQ_social_W0, na.rm = TRUE)*sqrt(0.86)
SEM_auditory_0 = sd(tab$SEQ_auditory_W0, na.rm = TRUE)*sqrt(1-0.92)
SEM_visual_0 = sd(tab$SEQ_visual_W0, na.rm = TRUE)*sqrt(1-0.92)
SEM_tactile_0 = sd(tab$SEQ_tactile_W0, na.rm = TRUE)*sqrt(1-0.92)
SEM_gusta_olfac_0 = sd(tab$SEQ_gusta_olfac_W0, na.rm = TRUE)*sqrt(1-0.92)
SEM_ves_pro_0 = sd(tab$SEQ_ves_pro_W0, na.rm = TRUE)*sqrt(1-0.92)

# SEM 2
SEM_total_112 = sd(tab$SEQ_total_W112, na.rm = TRUE)*sqrt(1-0.92)
SEM_HYPER_112 = sd(tab$SEQ_HYPER_W112, na.rm = TRUE)*sqrt(1-0.71)
SEM_HYPO_112 = sd(tab$SEQ_HYPO_W112, na.rm = TRUE)*sqrt(1-0.84)
SEM_SIRS_112 = sd(tab$SEQ_SIRS_W112, na.rm = TRUE)*sqrt(1-0.92)
SEM_EP_112 = sd(tab$SEQ_EP_W112, na.rm = TRUE)*sqrt(1-0.92)
SEM_nonsocial_112 = sd(tab$SEQ_nonsocial_W112, na.rm = TRUE)*sqrt(1-0.68)
SEM_social_112 = sd(tab$SEQ_social_W112, na.rm = TRUE)*sqrt(1-0.86)
SEM_auditory_112 = sd(tab$SEQ_auditory_W112, na.rm = TRUE)*sqrt(1-0.92)
SEM_visual_112 = sd(tab$SEQ_visual_W112, na.rm = TRUE)*sqrt(1-0.92)
SEM_tactile_112 = sd(tab$SEQ_tactile_W112, na.rm = TRUE)*sqrt(1-0.92)
SEM_gusta_olfac_112 = sd(tab$SEQ_gusta_olfac_W112, na.rm = TRUE)*sqrt(1-0.92)
SEM_ves_pro_112 = sd(tab$SEQ_ves_pro_W112, na.rm = TRUE)*sqrt(1-0.92)

# SEdiff
SE_total = sqrt((SEM_total_0^2)+(SEM_total_112^2))
SE_HYPER = sqrt((SEM_HYPER_0^2)+(SEM_HYPER_112^2))
SE_HYPO = sqrt((SEM_HYPO_0^2)+(SEM_HYPO_112^2))
SE_SIRS = sqrt((SEM_SIRS_0^2)+(SEM_SIRS_112^2))
SE_EP = sqrt((SEM_EP_0^2)+(SEM_EP_112^2))
SE_nonsocial = sqrt((SEM_nonsocial_0^2)+(SEM_nonsocial_112^2))
SE_social = sqrt((SEM_social_0^2)+(SEM_social_112^2))
SE_auditory = sqrt((SEM_auditory_0^2)+(SEM_auditory_112^2))
SE_visual = sqrt((SEM_visual_0^2)+(SEM_visual_112^2))
SE_tactile = sqrt((SEM_tactile_0^2)+(SEM_tactile_112^2))
SE_gusta_olfac = sqrt((SEM_gusta_olfac_0^2)+(SEM_gusta_olfac_112^2))
SE_ves_pro = sqrt((SEM_ves_pro_0^2)+(SEM_ves_pro_112^2))

# SEQ total
CI_total = SE_total* 1.64
tab$response_SEQ_total <- ifelse(tab$delta_SEQ_total >= CI_total, "improvement", 0)
tab$response_SEQ_total <- ifelse(abs(tab$delta_SEQ_total) < CI_total, "stable", tab$response_SEQ_total)
tab$response_SEQ_total <- ifelse(tab$delta_SEQ_total <= -CI_total, "decline", tab$response_SEQ_total)
sjmisc::frq(tab$response_SEQ_total)
# SEQ HYPER
CI_HYPER = SE_HYPER* 1.64
tab$response_SEQ_HYPER <- ifelse(tab$delta_SEQ_HYPER >= CI_HYPER, "improvement", 0)
tab$response_SEQ_HYPER <- ifelse(abs(tab$delta_SEQ_HYPER) < CI_HYPER, "stable", tab$response_SEQ_HYPER)
tab$response_SEQ_HYPER <- ifelse(tab$delta_SEQ_HYPER <= -CI_HYPER, "decline", tab$response_SEQ_HYPER)
sjmisc::frq(tab$response_SEQ_HYPER)
# SEQ HYPO
CI_HYPO = SE_HYPO* 1.64
tab$response_SEQ_HYPO <- ifelse(tab$delta_SEQ_HYPO >= CI_HYPO, "improvement", 0)
tab$response_SEQ_HYPO <- ifelse(abs(tab$delta_SEQ_HYPO) < CI_HYPO, "stable", tab$response_SEQ_HYPO)
tab$response_SEQ_HYPO <- ifelse(tab$delta_SEQ_HYPO <= -CI_HYPO, "decline", tab$response_SEQ_HYPO)
sjmisc::frq(tab$response_SEQ_HYPO)
# SEQ SIRS
CI_SIRS = SE_SIRS* 1.64
tab$response_SEQ_SIRS <- ifelse(tab$delta_SEQ_SIRS >= CI_SIRS, "improvement", 0)
tab$response_SEQ_SIRS <- ifelse(abs(tab$delta_SEQ_SIRS) < CI_SIRS, "stable", tab$response_SEQ_SIRS)
tab$response_SEQ_SIRS <- ifelse(tab$delta_SEQ_SIRS <= -CI_SIRS, "decline", tab$response_SEQ_SIRS)
sjmisc::frq(tab$response_SEQ_SIRS)
# SEQ EP
CI_EP = SE_EP* 1.64
tab$response_SEQ_EP <- ifelse(tab$delta_SEQ_EP >= CI_EP, "improvement", 0)
tab$response_SEQ_EP <- ifelse(abs(tab$delta_SEQ_EP) < CI_EP, "stable", tab$response_SEQ_EP)
tab$response_SEQ_EP <- ifelse(tab$delta_SEQ_EP <= -CI_EP, "decline", tab$response_SEQ_EP)
sjmisc::frq(tab$response_SEQ_EP)
# SEQ nonsocial
CI_nonsocial = SE_nonsocial* 1.64
tab$response_SEQ_nonsocial <- ifelse(tab$delta_SEQ_nonsocial >= CI_nonsocial, "improvement", 0)
tab$response_SEQ_nonsocial <- ifelse(abs(tab$delta_SEQ_nonsocial) < CI_nonsocial, "stable", tab$response_SEQ_nonsocial)
tab$response_SEQ_nonsocial <- ifelse(tab$delta_SEQ_nonsocial <= -CI_nonsocial, "decline", tab$response_SEQ_nonsocial)
sjmisc::frq(tab$response_SEQ_nonsocial)
# SEQ social
CI_social = SE_social* 1.64
tab$response_SEQ_social <- ifelse(tab$delta_SEQ_social >= CI_social, "improvement", 0)
tab$response_SEQ_social <- ifelse(abs(tab$delta_SEQ_social) < CI_social, "stable", tab$response_SEQ_social)
tab$response_SEQ_social <- ifelse(tab$delta_SEQ_social <= -CI_social, "decline", tab$response_SEQ_social)
sjmisc::frq(tab$response_SEQ_social)
# SEQ auditory
CI_auditory = SE_auditory* 1.64
tab$response_SEQ_auditory <- ifelse(tab$delta_SEQ_auditory >= CI_auditory, "improvement", 0)
tab$response_SEQ_auditory <- ifelse(abs(tab$delta_SEQ_auditory) < CI_auditory, "stable", tab$response_SEQ_auditory)
tab$response_SEQ_auditory <- ifelse(tab$delta_SEQ_auditory <= -CI_auditory, "decline", tab$response_SEQ_auditory)
sjmisc::frq(tab$response_SEQ_auditory)
# SEQ visual
CI_visual = SE_visual* 1.64
tab$response_SEQ_visual <- ifelse(tab$delta_SEQ_visual >= CI_visual, "improvement", 0)
tab$response_SEQ_visual <- ifelse(abs(tab$delta_SEQ_visual) < CI_visual, "stable", tab$response_SEQ_visual)
tab$response_SEQ_visual <- ifelse(tab$delta_SEQ_visual <= -CI_visual, "decline", tab$response_SEQ_visual)
sjmisc::frq(tab$response_SEQ_visual)
# SEQ tactile
CI_tactile = SE_tactile* 1.64
tab$response_SEQ_tactile <- ifelse(tab$delta_SEQ_tactile >= CI_tactile, "improvement", 0)
tab$response_SEQ_tactile <- ifelse(abs(tab$delta_SEQ_tactile) < CI_tactile, "stable", tab$response_SEQ_tactile)
tab$response_SEQ_tactile <- ifelse(tab$delta_SEQ_tactile <= -CI_tactile, "decline", tab$response_SEQ_tactile)
sjmisc::frq(tab$response_SEQ_tactile)
# SEQ gusta_olfac
CI_gusta_olfac = SE_gusta_olfac* 1.64
tab$response_SEQ_gusta_olfac <- ifelse(tab$delta_SEQ_gusta_olfac >= CI_gusta_olfac, "improvement", 0)
tab$response_SEQ_gusta_olfac <- ifelse(abs(tab$delta_SEQ_gusta_olfac) < CI_gusta_olfac, "stable", tab$response_SEQ_gusta_olfac)
tab$response_SEQ_gusta_olfac <- ifelse(tab$delta_SEQ_gusta_olfac <= -CI_gusta_olfac, "decline", tab$response_SEQ_gusta_olfac)
sjmisc::frq(tab$response_SEQ_gusta_olfac)
# SEQ ves_pro
CI_ves_pro = SE_ves_pro* 1.64
tab$response_SEQ_ves_pro <- ifelse(tab$delta_SEQ_ves_pro >= CI_ves_pro, "improvement", 0)
tab$response_SEQ_ves_pro <- ifelse(abs(tab$delta_SEQ_ves_pro) < CI_ves_pro, "stable", tab$response_SEQ_ves_pro)
tab$response_SEQ_ves_pro <- ifelse(tab$delta_SEQ_ves_pro <= -CI_ves_pro, "decline", tab$response_SEQ_ves_pro)
sjmisc::frq(tab$response_SEQ_ves_pro)
```

# Fréquences par groupe
```{r}
table(tab$condition, tab$response_AIM_atypical, useNA = "always")
table(tab$condition, tab$response_AIM_recip, useNA = "always")
table(tab$condition, tab$response_AIM_com, useNA = "always")
table(tab$condition, tab$response_AIM_rep_beh, useNA = "always")
table(tab$condition, tab$response_AIM_rep_lang, useNA = "always")

table(tab$condition, tab$response_ABC_hyper, useNA = "always")
table(tab$condition, tab$response_ABC_irrit, useNA = "always")
table(tab$condition, tab$response_ABC_ste_beh, useNA = "always")
table(tab$condition, tab$response_ABC_inap_speech, useNA = "always")
table(tab$condition, tab$response_ABC_soc_wit, useNA = "always")
table(tab$condition, tab$response_ABC_lethargy, useNA = "always")

table(tab$condition, tab$response_SEQ_HYPER, useNA = "always")
table(tab$condition, tab$response_SEQ_HYPO, useNA = "always")
table(tab$condition, tab$response_SEQ_SIRS, useNA = "always")
table(tab$condition, tab$response_SEQ_EP, useNA = "always")
table(tab$condition, tab$response_SEQ_social, useNA = "always")
table(tab$condition, tab$response_SEQ_nonsocial, useNA = "always")

table(tab$condition, tab$response_SEQ_auditory, useNA = "always")
table(tab$condition, tab$response_SEQ_visual, useNA = "always")
table(tab$condition, tab$response_SEQ_tactile, useNA = "always")
table(tab$condition, tab$response_SEQ_gusta_olfac, useNA = "always")
table(tab$condition, tab$response_SEQ_ves_pro, useNA = "always")
table(tab$condition, tab$response_SEQ_total, useNA = "always")
```

# Chi-square tests of independance
```{r}
# Pas oublier de soustraire les NA (ex. dans AIM atypical, c'est 28-1)

# AIM atypical --> OUI
table(tab$condition, tab$response_AIM_atypical, useNA = "always")
chisq_AIM_atypical <- data.frame(groupe = c(rep("ARBA", 28-1), rep("placebo", 31)),
                 improvement = c(rep(1, 9), rep(0, 28-1-9),
                           rep(1, 2), rep(0, 31-2)))

chisq.test(chisq_AIM_atypical$groupe, chisq_AIM_atypical$improvement)

# AIM recip 
table(tab$condition, tab$response_AIM_recip, useNA = "always")
chisq_AIM_recip <- data.frame(groupe = c(rep("ARBA", 28-1), rep("placebo", 31)),
                 improvement = c(rep(1, 4), rep(0, 28-1-4),
                           rep(1, 2), rep(0, 31-2)))

chisq.test(chisq_AIM_recip$groupe, chisq_AIM_recip$improvement)

# AIM com 
table(tab$condition, tab$response_AIM_com, useNA = "always")
chisq_AIM_com <- data.frame(groupe = c(rep("ARBA", 28-1), rep("placebo", 31)),
                 improvement = c(rep(1, 9), rep(0, 28-1-9),
                           rep(1, 4), rep(0, 31-4)))

chisq.test(chisq_AIM_com$groupe, chisq_AIM_com$improvement)

# AIM rep_beh 
table(tab$condition, tab$response_AIM_rep_beh, useNA = "always")
chisq_AIM_rep_beh <- data.frame(groupe = c(rep("ARBA", 28-1), rep("placebo", 31)),
                 improvement = c(rep(1, 8), rep(0, 28-1-8),
                           rep(1, 7), rep(0, 31-7)))

chisq.test(chisq_AIM_rep_beh$groupe, chisq_AIM_rep_beh$improvement)

# AIM rep_lang 
table(tab$condition, tab$response_AIM_rep_lang, useNA = "always")
chisq_AIM_rep_lang <- data.frame(groupe = c(rep("ARBA", 28-1), rep("placebo", 31)),
                 improvement = c(rep(1, 4), rep(0, 28-1-4),
                           rep(1, 3), rep(0, 31-3)))

chisq.test(chisq_AIM_rep_lang$groupe, chisq_AIM_rep_lang$improvement)
```


```{r}
# ABC hyper --> OUI
table(tab$condition, tab$response_ABC_hyper, useNA = "always")
chisq_ABC_hyper <- data.frame(groupe = c(rep("ARBA", 28), rep("placebo", 31)),
                 improvement = c(rep(1, 10), rep(0, 28-10),
                           rep(1, 3), rep(0, 31-3)))

chisq.test(chisq_ABC_hyper$groupe, chisq_ABC_hyper$improvement)

# ABC irrit
table(tab$condition, tab$response_ABC_irrit, useNA = "always")
chisq_ABC_irrit <- data.frame(groupe = c(rep("ARBA", 28), rep("placebo", 31)),
                 improvement = c(rep(1, 7), rep(0, 28-7),
                           rep(1, 3), rep(0, 31-3)))

chisq.test(chisq_ABC_irrit$groupe, chisq_ABC_irrit$improvement)

# ABC ste_beh
table(tab$condition, tab$response_ABC_ste_beh, useNA = "always")
chisq_ABC_ste_beh <- data.frame(groupe = c(rep("ARBA", 28-1), rep("placebo", 31)),
                 improvement = c(rep(1, 9), rep(0, 28-1-9),
                           rep(1, 5), rep(0, 31-5)))

chisq.test(chisq_ABC_ste_beh$groupe, chisq_ABC_ste_beh$improvement)

# ABC inap_speech
table(tab$condition, tab$response_ABC_inap_speech, useNA = "always")
chisq_ABC_inap_speech <- data.frame(groupe = c(rep("ARBA", 28), rep("placebo", 31)),
                 improvement = c(rep(1, 2), rep(0, 28-2),
                           rep(1, 1), rep(0, 31-1)))

chisq.test(chisq_ABC_inap_speech$groupe, chisq_ABC_inap_speech$improvement)


# ABC soc_wit
table(tab$condition, tab$response_ABC_soc_wit, useNA = "always")
chisq_ABC_soc_wit <- data.frame(groupe = c(rep("ARBA", 28), rep("placebo", 31)),
                 improvement = c(rep(1, 8), rep(0, 28-8),
                           rep(1, 4), rep(0, 31-4)))

chisq.test(chisq_ABC_soc_wit$groupe, chisq_ABC_soc_wit$improvement)


# ABC lethargy --> presque
table(tab$condition, tab$response_ABC_lethargy, useNA = "always")
chisq_ABC_lethargy <- data.frame(groupe = c(rep("ARBA", 28-1), rep("placebo", 31)),
                 improvement = c(rep(1, 9), rep(0, 28-1-9),
                           rep(1, 3), rep(0, 31-3)))

chisq.test(chisq_ABC_lethargy$groupe, chisq_ABC_lethargy$improvement)
```


```{r}
# SEQ HYPER
table(tab$condition, tab$response_SEQ_HYPER, useNA = "always")
chisq_SEQ_HYPER <- data.frame(groupe = c(rep("ARBA", 28-1), rep("placebo", 31)),
                 improvement = c(rep(1, 5), rep(0, 28-1-5),
                           rep(1, 3), rep(0, 31-3)))

chisq.test(chisq_SEQ_HYPER$groupe, chisq_SEQ_HYPER$improvement)

# SEQ HYPO
table(tab$condition, tab$response_SEQ_HYPO, useNA = "always")
chisq_SEQ_HYPO <- data.frame(groupe = c(rep("ARBA", 28-1), rep("placebo", 31)),
                 improvement = c(rep(1, 8), rep(0, 28-1-8),
                           rep(1, 6), rep(0, 31-6)))

chisq.test(chisq_SEQ_HYPO$groupe, chisq_SEQ_HYPO$improvement)

# SEQ SIRS
table(tab$condition, tab$response_SEQ_SIRS, useNA = "always")
chisq_SEQ_SIRS <- data.frame(groupe = c(rep("ARBA", 28-1), rep("placebo", 31)),
                 improvement = c(rep(1, 10), rep(0, 28-1-10),
                           rep(1, 6), rep(0, 31-6)))

chisq.test(chisq_SEQ_SIRS$groupe, chisq_SEQ_SIRS$improvement)

# SEQ EP
table(tab$condition, tab$response_SEQ_EP, useNA = "always")
chisq_SEQ_EP <- data.frame(groupe = c(rep("ARBA", 28-1), rep("placebo", 31)),
                 improvement = c(rep(1, 12), rep(0, 28-1-12),
                           rep(1, 9), rep(0, 31-9)))

chisq.test(chisq_SEQ_EP$groupe, chisq_SEQ_EP$improvement)
```


```{r}
# SEQ social
table(tab$condition, tab$response_SEQ_social, useNA = "always")
chisq_SEQ_social <- data.frame(groupe = c(rep("ARBA", 28-1), rep("placebo", 31)),
                 improvement = c(rep(1, 4), rep(0, 28-1-4),
                           rep(1, 3), rep(0, 31-3)))

chisq.test(chisq_SEQ_social$groupe, chisq_SEQ_social$improvement)

# SEQ nonsocial
table(tab$condition, tab$response_SEQ_nonsocial, useNA = "always")
chisq_SEQ_nonsocial <- data.frame(groupe = c(rep("ARBA", 28-1), rep("placebo", 31)),
                 improvement = c(rep(1, 4), rep(0, 28-1-4),
                           rep(1, 3), rep(0, 31-3)))

chisq.test(chisq_SEQ_nonsocial$groupe, chisq_SEQ_nonsocial$improvement)
```


```{r}
# SEQ visual
table(tab$condition, tab$response_SEQ_visual, useNA = "always")
chisq_SEQ_visual <- data.frame(groupe = c(rep("ARBA", 28-1), rep("placebo", 31)),
                 improvement = c(rep(1, 11), rep(0, 28-1-11),
                           rep(1, 8), rep(0, 31-8)))

chisq.test(chisq_SEQ_visual$groupe, chisq_SEQ_visual$improvement)

# SEQ auditory
table(tab$condition, tab$response_SEQ_auditory, useNA = "always")
chisq_SEQ_auditory <- data.frame(groupe = c(rep("ARBA", 28-1), rep("placebo", 31)),
                 improvement = c(rep(1, 7), rep(0, 28-1-7),
                           rep(1, 11), rep(0, 31-11)))

chisq.test(chisq_SEQ_auditory$groupe, chisq_SEQ_auditory$improvement)

# SEQ tactile
table(tab$condition, tab$response_SEQ_tactile, useNA = "always")
chisq_SEQ_tactile <- data.frame(groupe = c(rep("ARBA", 28-1), rep("placebo", 31)),
                 improvement = c(rep(1, 10), rep(0, 28-1-10),
                           rep(1, 8), rep(0, 31-8)))

chisq.test(chisq_SEQ_tactile$groupe, chisq_SEQ_tactile$improvement)

# SEQ gusta_olfac
table(tab$condition, tab$response_SEQ_gusta_olfac, useNA = "always")
chisq_SEQ_gusta_olfac <- data.frame(groupe = c(rep("ARBA", 28-1), rep("placebo", 31)),
                 improvement = c(rep(1, 7), rep(0, 28-1-7),
                           rep(1, 8), rep(0, 31-8)))

chisq.test(chisq_SEQ_gusta_olfac$groupe, chisq_SEQ_gusta_olfac$improvement)

# SEQ ves_pro
table(tab$condition, tab$response_SEQ_ves_pro, useNA = "always")
chisq_SEQ_ves_pro <- data.frame(groupe = c(rep("ARBA", 28-1), rep("placebo", 31)),
                 improvement = c(rep(1, 12), rep(0, 28-1-12),
                           rep(1, 8), rep(0, 31-8)))

chisq.test(chisq_SEQ_ves_pro$groupe, chisq_SEQ_ves_pro$improvement)

# SEQ total --> presque
table(tab$condition, tab$response_SEQ_total, useNA = "always")
chisq_SEQ_total <- data.frame(groupe = c(rep("ARBA", 28-1), rep("placebo", 31)),
                 improvement = c(rep(1, 12), rep(0, 28-1-12),
                           rep(1, 6), rep(0, 31-6)))

chisq.test(chisq_SEQ_total$groupe, chisq_SEQ_total$improvement)
```


```{r}
# VABS3 COM
table(tab$condition, tab$response_VABS3_COM, useNA = "always")
chisq_VABS3_COM <- data.frame(groupe = c(rep("ARBA", 28), rep("placebo", 31)),
                 improvement = c(rep(1, 7), rep(0, 28-7),
                           rep(1, 3), rep(0, 31-3)))

chisq.test(chisq_VABS3_COM$groupe, chisq_VABS3_COM$improvement)

# VABS3 SOC
table(tab$condition, tab$response_VABS3_SOC, useNA = "always")
chisq_VABS3_SOC <- data.frame(groupe = c(rep("ARBA", 28), rep("placebo", 31)),
                 improvement = c(rep(1, 5), rep(0, 28-5),
                           rep(1, 3), rep(0, 31-3)))

chisq.test(chisq_VABS3_SOC$groupe, chisq_VABS3_SOC$improvement)

# VABS3 IPR_GSV
table(tab$condition, tab$response_VABS3_IPR_GSV, useNA = "always")
chisq_VABS3_IPR_GSV <- data.frame(groupe = c(rep("ARBA", 28), rep("placebo", 31)),
                 improvement = c(rep(1, 7), rep(0, 28-7),
                           rep(1, 3), rep(0, 31-3)))

chisq.test(chisq_VABS3_IPR_GSV$groupe, chisq_VABS3_IPR_GSV$improvement)

# VABS3 PLA_GSV
table(tab$condition, tab$response_VABS3_PLA_GSV, useNA = "always")
chisq_VABS3_PLA_GSV <- data.frame(groupe = c(rep("ARBA", 28), rep("placebo", 31)),
                 improvement = c(rep(1, 4), rep(0, 28-4),
                           rep(1, 3), rep(0, 31-3)))

chisq.test(chisq_VABS3_PLA_GSV$groupe, chisq_VABS3_PLA_GSV$improvement)

# VABS3 COP_GSV
table(tab$condition, tab$response_VABS3_COP_GSV, useNA = "always")
chisq_VABS3_COP_GSV <- data.frame(groupe = c(rep("ARBA", 28), rep("placebo", 31)),
                 improvement = c(rep(1, 3), rep(0, 28-3),
                           rep(1, 2), rep(0, 31-2)))

chisq.test(chisq_VABS3_COP_GSV$groupe, chisq_VABS3_COP_GSV$improvement)
```








```{r}
# Placebo
mytable_AIM_atypical_p <- table(subset(tab, condition == "placebo")$response_AIM_atypical)
lbls <- paste(names(mytable_AIM_atypical_p), "\n", mytable_AIM_atypical_p, sep="")
pie(mytable_AIM_atypical_p, labels = lbls,
   main="AIM - Atypical behaviour : placebo", col = rainbow(length(mytable_AIM_atypical_p)))


# ARBA
mytable_AIM_atypical_A <- table(subset(tab, condition == "ARBA")$response_AIM_atypical)
lbls <- paste(names(mytable_AIM_atypical_A), "\n", mytable_AIM_atypical_A, sep="")
pie(mytable_AIM_atypical_A, labels = lbls,
   main="AIM - Atypical behaviour : ARBA", col = rainbow(length(mytable_AIM_atypical_A)))
```



```{r}
ggplot(tab,
       aes(x=AIM_atypical_W0,
           y=delta_AIM_atypical,
           ))+
  geom_point()+
  geom_smooth(method='lm')+
  scale_fill_hue(l=30)+scale_colour_hue(l=30)+
  theme_classic() +
  labs(x = "Baseline score", y = "improvement")
ggsave("C:/Users/Admin/Desktop/ARBA/EEG behavioral measures/reg_improvement_AIM_atypical.png")
```

```{r}
ggplot(subset(tab, response_AIM_com == "improvement"),
       aes(x = condition,
           y = age,
           colour=condition,
           fill=condition)) +
  stat_summary(fun = mean, geom = 'bar', alpha = 0.5) +
  stat_summary(fun.data = mean_se, geom = 'errorbar', width = 0.1) +
  geom_point()
ggsave("C:/Users/Admin/Desktop/ARBA/EEG behavioral measures/improvement_AIM_com.png")
```

```{r}
ggplot(tab,
       aes(x = response_AIM_atypical,
           y = AIM_atypical_W0,
           colour=response_AIM_atypical,
           fill=response_AIM_atypical)) +
  stat_summary(fun = mean, geom = 'bar', alpha = 0.5) +
  stat_summary(fun.data = mean_se, geom = 'errorbar', width = 0.1) +
  geom_point()
ggsave("C:/Users/Admin/Desktop/ARBA/EEG behavioral measures/response_type_AIM_com.png")
```




```{r}
ggplot(tab, aes(x=response_AIM_atypical, y=nbr_AE, fill = response_AIM_atypical))+
  geom_bar(stat='identity')+
  facet_wrap(~condition)

ggplot(tab, aes(x=response_AIM_atypical, y=AIM_atypical_W0, fill = response_AIM_atypical))+
  geom_bar(stat='identity')+
  facet_wrap(~condition)
```

```{r}
ggplot(tab, aes(x=response_AIM_com, y=age, fill = response_AIM_com))+
  geom_bar(stat='identity')+
  facet_wrap(~condition)
```